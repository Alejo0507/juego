<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dos personajes con controles distintos</title>
<style>
  html,body { height:100%; margin:0; background:#7bf35d; overflow:hidden; }
  #personaje1, #personaje2 {
    position: absolute;
    bottom: 50px;
    width: 80px;
    height: auto;
    transform-origin: center bottom; 
    will-change: transform, left, bottom;
  }
  #personaje1 { left: 100px; }
  #personaje2 { left: 300px; }
  #hitbox1, #hitbox2 {
    position: absolute;
    border: 2px solid blue;
    pointer-events: none;
    z-index: 1000;
  }
</style>
</head>
<body>

<img id="personaje1" src="./personajes/estatico.png" alt="Personaje 1">
<div id="hitbox1"></div>

<img id="personaje2" src="./personajes/estatico2.png" alt="Personaje 2">
<div id="hitbox2"></div>

<script>
// ===== RUTAS =====
const PATH1 = {
  idle:  './personajes/estatico.png',
  run:   './personajes/correr2.gif',
  jump:  './personajes/saltar.png',
  crouch:'./personajes/agachar.png'
};
const PATH2 = {
  idle:  './personajes/estatico2.png',
  run:   './personajes/correr3.gif',
  jump:  './personajes/saltar2.png',
  crouch:'./personajes/agachar2.png'
};

// ===== SONIDOS =====
// Personaje 1
const sonidoSalto1 = new Audio('sonidos/salto.mp3');
const sonidoCorrer1 = new Audio('sonidos/correr.mp3');
function playJumpSound1() {
    sonidoSalto1.currentTime = 0;
    sonidoSalto1.play();
}
function playRunSound1() {
    sonidoCorrer1.currentTime = 0;
    sonidoCorrer1.loop = true;
    sonidoCorrer1.play();
}
function stopRunSound1() {
    sonidoCorrer1.pause();
    sonidoCorrer1.currentTime = 0;
}

// Personaje 2
const sonidoSalto2 = new Audio('sonidos/salto.mp3');
const sonidoCorrer2 = new Audio('sonidos/correr.mp3');
function playJumpSound2() {
    sonidoSalto2.currentTime = 0;
    sonidoSalto2.play();
}
function playRunSound2() {
    sonidoCorrer2.currentTime = 0;
    sonidoCorrer2.loop = true;
    sonidoCorrer2.play();
}
function stopRunSound2() {
    sonidoCorrer2.pause();
    sonidoCorrer2.currentTime = 0;
}

// ===== VARIABLES =====
const p1 = document.getElementById('personaje1');
const p2 = document.getElementById('personaje2');
const hb1 = document.getElementById('hitbox1');
const hb2 = document.getElementById('hitbox2');

let posX1 = 100, posY1 = 50, vx1 = 0, vy1 = 0, jumping1 = false, crouching1 = false;
let posX2 = 300, posY2 = 50, vx2 = 0, vy2 = 0, jumping2 = false, crouching2 = false;

let currentAnim1 = 'idle';
let currentAnim2 = 'idle';
let facing1 = 1;
let facing2 = 1;

const WALK_SPEED = 2;
const JUMP_SPEED = 12;
const GRAVITY = 0.6;
const hitboxWidth = 45;
const hitboxHeight = 65;
const spriteWidth = 60;

let keys = {};

// ===== ANIMACIÃ“N =====
function setAnim1(name) {
  if (currentAnim1 !== name) {
    currentAnim1 = name;
    p1.src = PATH1[name];
  }
}
function setAnim2(name) {
  if (currentAnim2 !== name) {
    currentAnim2 = name;
    p2.src = PATH2[name];
  }
}

// ===== TECLADO =====
window.addEventListener('keydown', e => {
  if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown','w','a','s','d'].includes(e.key)) e.preventDefault();
  if (!keys[e.key]) {
    keys[e.key] = true;

    // Personaje 1
    if (e.key === 'w' && !jumping1) {
      stopRunSound1();
      playJumpSound1();
      jumping1 = true;
      vy1 = JUMP_SPEED;
      setAnim1('jump');
      crouching1 = false;
    }
    if (e.key === 's' && !jumping1) {
      crouching1 = true;
      setAnim1('crouch');
      stopRunSound1();
    }
    if (e.key === 'a') facing1 = -1;
    if (e.key === 'd') facing1 = 1;

    // Personaje 2
    if (e.key === 'ArrowUp' && !jumping2) {
      stopRunSound2();
      playJumpSound2();
      jumping2 = true;
      vy2 = JUMP_SPEED;
      setAnim2('jump');
      crouching2 = false;
    }
    if (e.key === 'ArrowDown' && !jumping2) {
      crouching2 = true;
      setAnim2('crouch');
      stopRunSound2();
    }
    if (e.key === 'ArrowLeft') facing2 = -1;
    if (e.key === 'ArrowRight') facing2 = 1;
  }
});

window.addEventListener('keyup', e => {
  keys[e.key] = false;
  if (e.key === 's') crouching1 = false;
  if (e.key === 'ArrowDown') crouching2 = false;
});

// ===== BUCLE =====
function loop() {
  // Personaje 1
  if (crouching1) vx1 = 0;
  else if (keys['d'] && !keys['a']) vx1 = WALK_SPEED;
  else if (keys['a'] && !keys['d']) vx1 = -WALK_SPEED;
  else vx1 = 0;

  if (jumping1) {
    posY1 += vy1;
    vy1 -= GRAVITY;
    if (posY1 <= 50) {
      posY1 = 50; vy1 = 0; jumping1 = false;
    }
  }
  if (!jumping1 && !crouching1) {
    if (vx1 !== 0) {
      setAnim1('run');
      if (sonidoCorrer1.paused) playRunSound1();
    } else {
      setAnim1('idle');
      stopRunSound1();
    }
  } else if (jumping1) {
    stopRunSound1();
  }
  posX1 += vx1;

  // Personaje 2
  if (crouching2) vx2 = 0;
  else if (keys['ArrowRight'] && !keys['ArrowLeft']) vx2 = WALK_SPEED;
  else if (keys['ArrowLeft'] && !keys['ArrowRight']) vx2 = -WALK_SPEED;
  else vx2 = 0;

  if (jumping2) {
    posY2 += vy2;
    vy2 -= GRAVITY;
    if (posY2 <= 50) {
      posY2 = 50; vy2 = 0; jumping2 = false;
    }
  }
  if (!jumping2 && !crouching2) {
    if (vx2 !== 0) {
      setAnim2('run');
      if (sonidoCorrer2.paused) playRunSound2();
    } else {
      setAnim2('idle');
      stopRunSound2();
    }
  } else if (jumping2) {
    stopRunSound2();
  }
  posX2 += vx2;

  // Aplicar posiciones y giro
  p1.style.left = posX1 + 'px';
  p1.style.bottom = posY1 + 'px';
  p1.style.transform = `scaleX(${facing1})`;
  p2.style.left = posX2 + 'px';
  p2.style.bottom = posY2 + 'px';
  p2.style.transform = `scaleX(${facing2})`;

  // Hitboxes
  hb1.style.left = (posX1 + (spriteWidth - hitboxWidth) / 2) + 'px';
  hb1.style.bottom = (posY1 + 5) + 'px';
  hb1.style.width = hitboxWidth + 'px';
  hb1.style.height = hitboxHeight + 'px';
  hb2.style.left = (posX2 + (spriteWidth - hitboxWidth) / 2) + 'px';
  hb2.style.bottom = (posY2 + 5) + 'px';
  hb2.style.width = hitboxWidth + 'px';
  hb2.style.height = hitboxHeight + 'px';

  requestAnimationFrame(loop);
}

setAnim1('idle');
setAnim2('idle');
loop();
</script>
</body>
</html>
